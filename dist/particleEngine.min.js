/*! particleEngine 26-12-2014 */
!function(a){"use strict";var b=(a.document||{},function(b){function c(a){for(var b=Array.prototype.slice.call(arguments),d=1;d<b.length;d++)for(var e in b[d])b[d].hasOwnProperty(e)&&("object"==typeof b[d][e]&&b[d][e]instanceof Array==!1?(a[e]={},c(a[e],b[d][e])):a[e]=b[d][e]);return a}function d(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function e(a,b){return a+Math.random()*(b-a)}function f(a){if(a.direction=e(a.direction,a.spread),a.speed.x+=Math.random()*a.speed.spread,a.speed.y+=Math.random()*a.speed.spread,a.size.x+=Math.random()*a.size.spread,a.size.y+=Math.random()*a.size.spread,"string"==typeof a.color){var b=d(a.color);a.color=[b.r,b.g,b.b]}return a.color=a.color.map(Math.floor),a}if("undefined"==typeof b)throw new Error("particles must be defined with a canvas context");var g=b,h={snow:{},rain:{},fire:{},ice:{},smoke:{},test:{direction:7*Math.PI/4,spread:5*Math.PI/4,color:[0,0,0],speed:{x:.5,y:.5,spread:2},alpha:1,size:{x:1,y:1,spread:4},decay:Math.sqrt(g.canvas.width*g.canvas.width+g.canvas.height*g.canvas.height)/2}},i={weight:0,direction:0,spread:0,position:{x:0,y:0},speed:{x:0,y:0,spread:0},color:[],size:{height:0,width:0,spread:0},sprite:!1,shape:!1,alpha:0,decay:0},j={max:100,density:1,cycleOnce:!1,finished:!1,stopped:!1},k=function(b,d){if("undefined"==typeof b)throw new Error("Emitter needs to be passed to a collection");var h=[],k=c({},j,d);return{properties:k,emitter:b,exportParticle:function(){return a.JSON.stringify(this.emitter.particle)},cycle:function(){var a=0;if(this.numParticles()<this.properties.max&&this.properties.finished===!1)for(;a++<this.properties.density;)this.addParticle(),this.numParticles()>=this.properties.max&&this.properties.cycleOnce&&(this.properties.finished=!0)},reset:function(){h=[],g.clearRect(0,0,g.canvas.width,g.canvas.height),this.properties.finished=!1},addParticle:function(){if(this.properties.stopped===!1){var a=c({},i,b.particle);a=f(a);var d={x:e(b.properties.origin.x,b.properties.origin.x+b.properties.width),y:e(b.properties.origin.y,b.properties.origin.y+b.properties.height)};c(a.position,d),h.push(a)}},numParticles:function(){return h.length},draw:function(){this.cycle();var a,c=0;for(h.length;a=h[c];c++){a.position.x+=a.speed.x*Math.cos(a.direction),a.position.y-=a.speed.y*Math.sin(a.direction);var d=a.position.x-(b.properties.origin.x+b.properties.width),e=a.position.y-(b.properties.origin.y+b.properties.height),f=Math.sqrt(d*d+e*e);a.alpha=1-f/a.decay,a.alpha<=0&&h.splice(c,1),g.fillStyle="rgba("+a.color.join()+","+a.alpha+")",g.beginPath(),g.arc(a.position.x,a.position.y,a.size.x*a.size.y/2,0,2*Math.PI,!0),g.closePath(),g.fill()}}}},l=function(a,b){var d,e={origin:{x:0,y:0},height:1,width:1};if(c({},e,b),"string"==typeof a){if(d=h[a],"undefined"==typeof h[a])throw new Error(a+" Does not exist")}else{if("undefined"==typeof a)throw new Error("Undefined particle type");d=a}return{properties:e,particle:d,setOrigin:function(a,b){this.properties.origin.x=a,this.properties.origin.y=b}}};return{collection:k,emitter:l,updateContext:function(a){g=a}}});b.VERSION="0.1.0",a.particles=b}(this);